# 网络工具篇

## ifconfig

ifconfig 是我们查看当前系统的网卡和 ip 地址信息的最常用命令。如果你的机器上还没安装 ifconfig 命令，可以使用如下命令安装：

> yum install net-tools

安装成功以后，就可以使用 ifconfig 查看机器网卡信息了：
```shell
[root@localhost ~]# ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1005  bytes 77224 (75.4 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 349  bytes 47206 (46.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 4  bytes 352 (352.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4  bytes 352 (352.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

上述输出显示了本机当前激活的网卡列表，以及每个激活的网卡（网络设备）的 ipv4、ipv6 地址、子网掩码、广播地址等信息，这里一共两个网卡，分别是 ens33 和 lo。

可以使用 -s 选项显示网卡信息的精简列表：
```shell
[root@localhost ~]# ifconfig -s
Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
ens33            1500     1086      0      0 0           379      0      0      0 BMRU
lo              65536        4      0      0 0             4      0      0      0 LRU
```

默认情况下，ifconfig 命令只会显示激活的网卡信息，可以使用 -a 选项显示所有的（包括未激活）的网卡信息。

使用 ifconfig up 命令激活某个网卡，使用 ifconfig down 命令禁用某个网卡，这两个命令的用法如下：

```shell
ifconfig 网卡名 up
ifconfig 网卡名 down
```

演示一下这两个命令的用法：
```shell
[root@localhost ~]# ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1398  bytes 114269 (111.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 601  bytes 97657 (95.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 12  bytes 1056 (1.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1056 (1.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

## 禁用网卡 lo 后默认只能看到一个网卡信息
[root@localhost ~]# ifconfig lo down
[root@localhost ~]# ifconfig 
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1510  bytes 123232 (120.3 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 657  bytes 104751 (102.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root@localhost ~]# ifconfig -a
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1543  bytes 125948 (122.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 675  bytes 107251 (104.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=8<LOOPBACK>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 12  bytes 1056 (1.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1056 (1.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
## 再次启用网卡 lo
[root@localhost ~]# ifconfig lo up
[root@localhost ~]# ifconfig 
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1615  bytes 131924 (128.8 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 715  bytes 112423 (109.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 12  bytes 1056 (1.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1056 (1.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

ifconfig 还可以将一个 ip 地址绑定到某个网卡上，或将一个 ip 地址从某个网卡上解绑，使用如下命令：
```shell
# 将指定ip地址绑定到某个网卡
ifconfig 网卡名 add ip地址
# 从某个网卡解绑指定ip地址
ifconfig 网卡名 del ip地址
```

演示上述两个操作如下：
```shell
[root@localhost ~]# ifconfig 
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1615  bytes 131924 (128.8 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 715  bytes 112423 (109.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 12  bytes 1056 (1.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1056 (1.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root@localhost ~]# ifconfig ens33 add 192.168.206.150
[root@localhost ~]# ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 1804  bytes 145940 (142.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 781  bytes 119581 (116.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ens33:0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.150  netmask 255.255.255.0  broadcast 192.168.206.255
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 12  bytes 1056 (1.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1056 (1.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

上述操作中，网卡 ens33 开始绑定了 ip 地址 192.168.206.140，使用 ifconfig add 命令绑定了一个新的 ip ：192.168.206.150，现在可以使用这个新的 ip 地址来访问原来的网络了。

同理，如果要解绑这个 ip 地址，可以按如下操作：
```shell
[root@localhost ~]# ifconfig ens33 del 192.168.206.150
[root@localhost ~]# ifconfig -a
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.206.140  netmask 255.255.255.0  broadcast 192.168.206.255
        inet6 fe80::1599:dcc4:b3e8:7fce  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ee:01:80  txqueuelen 1000  (Ethernet)
        RX packets 2127  bytes 172321 (168.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 953  bytes 139954 (136.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 18  bytes 1560 (1.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 18  bytes 1560 (1.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

> 在 Windows 上与 ifconfig 相对应的命令是 ipconfig，如在 Windows 上查看所有网卡信息可以使用 ipconfig /all。

## ping
ping 命令是我们最常用的命令之一，一般用于侦测本机到目标主机的网络是否通畅。其使用方法是：

> ping ip地址

使用方法如下：
```shell
[root@localhost ~]# ping 120.55.94.78
PING 120.55.94.78 (120.55.94.78) 56(84) bytes of data.
64 bytes from 120.55.94.78: icmp_seq=1 ttl=128 time=11.0 ms
64 bytes from 120.55.94.78: icmp_seq=2 ttl=128 time=17.3 ms
64 bytes from 120.55.94.78: icmp_seq=3 ttl=128 time=16.2 ms
64 bytes from 120.55.94.78: icmp_seq=4 ttl=128 time=10.6 ms
64 bytes from 120.55.94.78: icmp_seq=5 ttl=128 time=10.2 ms
64 bytes from 120.55.94.78: icmp_seq=6 ttl=128 time=18.7 ms
64 bytes from 120.55.94.78: icmp_seq=7 ttl=128 time=15.8 ms
64 bytes from 120.55.94.78: icmp_seq=8 ttl=128 time=10.8 ms
64 bytes from 120.55.94.78: icmp_seq=9 ttl=128 time=10.8 ms
64 bytes from 120.55.94.78: icmp_seq=10 ttl=128 time=11.5 ms
```
上面的输出为目标网络可达的情形。在 Linux 操作系统上，如果目标网络不可达，ping 命令会一直发送而无输出结果，直到按下 Ctrl + C 中断下来才会有统计结果，效果如下：

```shell
[root@localhost ~]# ping 120.55.94.79
PING 120.55.94.79 (120.55.94.79) 56(84) bytes of data.
^C
--- 120.55.94.79 ping statistics ---
578 packets transmitted, 0 received, 100% packet loss, time 577119ms
```

> Windows 系统上，这种情况下，ping 命令会返回超时的包数量，而不是一直阻塞。且在 Linux 系统上 ping 命令是一直发送数据包，直到人工主动中断；而 Windows 机器上默认会发送 4 个数据包后停止，如果想一直发送而不停止，可以使用 -t 选项。

当然，ping 命令的目标也可以是一个域名，这样通过 ping 这个域名，我们可以得到这个域名解析后的 ip 地址：
```shell
[root@localhost ~]# ping www.baidu.com
PING www.a.shifen.com (61.135.169.121) 56(84) bytes of data.
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=1 ttl=128 time=30.3 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=2 ttl=128 time=28.8 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=3 ttl=128 time=29.0 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=4 ttl=128 time=31.9 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=5 ttl=128 time=28.8 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=6 ttl=128 time=27.8 ms
64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq=7 ttl=128 time=29.0 ms
^C
--- www.a.shifen.com ping statistics ---
7 packets transmitted, 7 received, 0% packet loss, time 6011ms
rtt min/avg/max/mdev = 27.822/29.430/31.968/1.244 ms
```

这里得到 www.baidu.com 对应的 ip 地址是 61.135.169.121。

> ping 命令是通过发送 ICMP 数据包来实现的。

ICMP（Internet Control Message Protocol）是因特网控制消息协议，是互联网协议族的一个组成部分。它用于在 IP 网络上发送控制消息，主要用于网络故障排除和错误报告。ICMP 是在网络层（OSI 模型中的第三层）操作的。

以下是 ICMP 的一些常见用途：

1. 网络故障排除： ICMP 提供了用于检测网络连接和诊断网络问题的工具。例如，通过 ICMP Echo 请求和回应（常见的 Ping 工具使用了 ICMP Echo 请求和回应），可以测试主机之间的可达性。

2. 差错报告： 当 IP 数据包在传输过程中遇到问题时，网络设备可以使用 ICMP 报告错误。例如，当一个数据包无法传递到目标主机时，中间路由器可能会发送 ICMP 差错报文通知源主机。

3. 跟踪路由（Traceroute）： ICMP 的一种类型被用于跟踪数据包从源到目的地的路径。通过在数据包的 TTL（Time To Live）字段上逐渐减小数值，可以收到每个中间路由器的 ICMP 时间超时报文，从而追踪整个路径。

4. 重定向消息： ICMP 可以用于通知主机将其数据流量发送到更优选的路由器。

ICMP 主要包括不同类型的消息，每种消息用于不同的目的。一些常见的 ICMP 消息类型包括：

- Echo Request / Echo Reply： 用于 Ping 测试。

- Destination Unreachable： 当一个主机无法访问目标主机时发送。

- Time Exceeded： 当数据包在传输过程中超过一定的时间限制时发送，用于跟踪路由。

- Redirect： 用于通知主机发送数据包到更优选的路由器。

> 请注意，由于 ICMP 可能被滥用用于进行攻击，一些网络环境中可能会对 ICMP 消息进行过滤。

















